C51 COMPILER V9.01   MAIN                                                                  05/10/2018 13:10:22 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg52.h>
   2          typedef unsigned int uint;
   3          typedef unsigned char uchar;
   4          
   5          sbit R1 = P1 ^ 1; //    right   +
   6          sbit R2 = P1 ^ 0; //    right   -
   7          sbit L1 = P1 ^ 2; //    left    +
   8          sbit L2 = P1 ^ 3; //    left    -
   9          //Sensor Bleak-1
  10          sbit Sen_L = P1 ^ 5; // sensor left
  11          sbit Sen_R = P1 ^ 4; // sensor right
  12          
  13          sbit Sen_Red = P3 ^ 4;  //Sen Red
  14          sbit K=P0 ^ 7;
  15          sbit S1 = P0^1; 
  16          sbit pwm1 = P0 ^ 5;  //输出PWM信号
  17          sbit pwm2 = P0 ^ 3;
  18          uint pwm_value = 1500; //初值为1.5ms
  19          uchar flag = 0;        //Flag
  20          
  21          void delay_ms(uint x)
  22          {
  23   1          uint i;
  24   1          while (x--)
  25   1              for (i = 0; i < 125; i++)
  26   1                  ;
  27   1      }
  28          
  29          void InitTimer(void)
  30          {
  31   1          TMOD = 0x11;        //开定时器0,1
  32   1          TH0 = -20000 / 256; //定时20MS,20MS为一个周期
  33   1          TL0 = -20000 % 256;
  34   1          TH1 = -1500 / 256; //定时1.5MS,这时舵机处于0度
  35   1          TL1 = -1500 % 256;
  36   1          EA = 1;  //开总断
  37   1          TR0 = 1; //开定时器0
  38   1          ET0 = 1;
  39   1          TR1 = 1; //开定时器1
  40   1          ET1 = 1;
  41   1      }
  42          
  43          void timer0(void) interrupt 1 //定时器0中断函数
  44          {
  45   1          switch (flag)
  46   1          {
  47   2          case 1:
  48   2              pwm1 = 1;
  49   2              break;
  50   2          case 2:
  51   2              pwm2 = 1;
  52   2              break;
  53   2              case 3:
  54   2                      K = 1;
  55   2                      break;
C51 COMPILER V9.01   MAIN                                                                  05/10/2018 13:10:22 PAGE 2   

  56   2              case 4:
  57   2                      pwm2=1;
  58   2                      K=1;
  59   2                      break;
  60   2              case 5:
  61   2                      pwm1=1;
  62   2                      K=1;
  63   2                      break;
  64   2          }
  65   1          TH0 = -20000 / 256;
  66   1          TL0 = -20000 % 256;
  67   1          TR1 = 1;
  68   1      }
  69          
  70          
  71          void timer1(void) interrupt 3 //定时器1中断函数
  72          {
  73   1          switch (flag)
  74   1          {
  75   2          case 1:
  76   2              pwm1 = 0;
  77   2              break;
  78   2          case 2:
  79   2              pwm2 = 0;
  80   2              break;
  81   2              case 3:
  82   2                      K = 0;
  83   2                      break;     
  84   2              case 4:
  85   2                      pwm2=0;
  86   2                      K=0;
  87   2                      break;
  88   2              case 5:
  89   2                      pwm1=0;
  90   2                      K=0;
  91   2                      break;
  92   2          }
  93   1          TH1 = -pwm_value / 256;
  94   1          TL1 = -pwm_value % 256;
  95   1          TR1 = 0;
  96   1      }
  97          
  98          void Stop(unsigned char type)
  99          {
 100   1          unsigned char i;
 101   1          for (i = 0; i < 5; i++)
 102   1          {
 103   2                      pwm_value=(uint)(2750-250*type);
 104   2              delay_ms(1000);
 105   2          }
 106   1      }
 107          
 108          void Sleep(unsigned char z)
 109          {
 110   1          unsigned char i, j;
 111   1              while(z--)
 112   1              for (i = 0; i < 255; i++)
 113   1                      for (j = 0; j < 255; j++);
 114   1      }
 115          
 116          void Run()
 117          {
C51 COMPILER V9.01   MAIN                                                                  05/10/2018 13:10:22 PAGE 3   

 118   1          R1 = 0;
 119   1          L1 = 0;
 120   1          R2 = 1;
 121   1          L2 = 1;
 122   1          P2 = ~3;
 123   1      }
 124          void TurnLeft()
 125          {
 126   1          R1 = 0;
 127   1          L1 = 1;
 128   1          R2 = 1;
 129   1          L2 = 0;
 130   1          P2 = ~5;
 131   1      }
 132          void TurnRight()
 133          {
 134   1          R1 = 1;
 135   1          R2 = 0;
 136   1          L1 = 0;
 137   1          L2 = 1;
 138   1          P2 = ~9;
 139   1      }
 140          void Down()
 141          {
 142   1          R1 = 1;
 143   1          R2 = 0;
 144   1          L1 = 1;
 145   1          L2 = 0;
 146   1          P2 = ~17;
 147   1      }
 148          void CarStop()
 149          {
 150   1          R1 = 1;
 151   1          R2 = 1;
 152   1          L1 = 1;
 153   1          L2 = 1;
 154   1          P2 = ~33;
 155   1      }
 156                   
 157          void Runing()
 158          {
 159   1              if (Sen_L == 0 && Sen_R == 0) 
 160   1                      Run();
 161   1              else if (Sen_L == 1 && Sen_R == 0)
 162   1                  TurnRight();
 163   1              else if (Sen_L == 0 && Sen_R == 1)
 164   1                      TurnLeft();
 165   1              else
 166   1                      Down();
 167   1              Sleep(1);       
 168   1      }
 169          
 170          void GetBall()
 171          {        
 172   1          flag = 1;
 173   1              P2=~4;
 174   1          Stop(5); //LR舵机R位
 175   1                                                                 
 176   1              flag=3;
 177   1              Stop(5); //open
 178   1      
 179   1          flag = 2;
C51 COMPILER V9.01   MAIN                                                                  05/10/2018 13:10:22 PAGE 4   

 180   1              P2=~8;
 181   1          Stop(7); //UD舵机D位
 182   1      
 183   1              //--------------
 184   1              flag=3;
 185   1              Stop(8); //close
 186   1      
 187   1          flag = 4;
 188   1              P2=~16;
 189   1          Stop(10); //UD舵机U位
 190   1      
 191   1          flag = 5;
 192   1              P2=~32;
 193   1          Stop(8); //LR-M
 194   1      
 195   1          flag = 2;
 196   1              P2=~64;                                                                    
 197   1          Stop(9); //UD舵机D位(45)
 198   1              
 199   1              flag=3;
 200   1              Stop(5); //open
 201   1      
 202   1          flag = 2;
 203   1              P2=~128;
 204   1          Stop(10); //UD舵机U位
 205   1      }
 206          
 207          
 208          void main(void) //主函数
 209          {               
 210   1              CarStop();
 211   1              delay_ms(500);
 212   1          InitTimer();         
 213   1          pwm_value = 1500; 
 214   1          flag = 2;
 215   1              P2=~1;
 216   1          Stop(10); //UD舵机U位(90)
 217   1          flag = 1;
 218   1              P2=~2;
 219   1          Stop(8); //LR舵机M位
 220   1              P2=~4;  
 221   1              flag=3;
 222   1              Stop(5);        //open
 223   1          while (1)
 224   1          {
 225   2                      if(S1==0){
 226   3                              CarStop();
 227   3                              GetBall();
 228   3                      }
 229   2                      else
 230   2                              Runing();
 231   2          }
 232   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    496    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.01   MAIN                                                                  05/10/2018 13:10:22 PAGE 5   

   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
